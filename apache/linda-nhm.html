<!DOCTYPE html>
<html>
  <head>
    <title>Linda - Lincoln's Patrol Bot</title>
    <link 	rel="icon" 
      		type="image/png" 
      		href="http://strands.acin.tuwien.ac.at/logos/strands2.png">

    <meta charset="utf-8" />
    <META HTTP-EQUIV="Pragma" CONTENT="no-cache">
    <META HTTP-EQUIV="Expires" CONTENT="-1">

    <!-- The default styling is provided by http://getbootstrap.com -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/jquery-ui.css" />

    <!-- jQuery and display.js are conveniences for interacting with the DOM -->
    <script src="js/jquery.js"></script>
    <script src="js/display.js"></script>

    <script type="text/javascript" src="js/jquery-ui.js"></script>

    <!-- ROSLIBJS -->
    <!-- EventEmitter2 is the sole dependency of roslibjs -->
    <script src="roslibjs/include/EventEmitter2/eventemitter2.js"></script>
    <!-- Roslibjs handles core ROS functionality in the browser -->
    <script src="roslibjs/build/roslib.js"></script>

    <!-- ROS2DJS -->
    <!-- EaselJS is a dependency of ros2djs -->
    <script src="ros2djs/include/EaselJS/easeljs.js"></script>
    <!-- Ros2djs provides 2D scene support, including mapping and more -->
    <script src="ros2djs/build/ros2d.js"></script>

    <!-- ROS3DJS -->
    <!-- Three.js is the WebGL rendering library -->
    <script src="ros3djs/include/threejs/three.js"></script>
    <!-- ColladaLoader2 loads collada models of the robot -->
    <script src="ros3djs/include/ColladaAnimationCompress/ColladaLoader2.js"></script>
    <!-- Ros3djs provides 3D scene support, including mapping and more -->
    <script src="ros3djs/build/ros3d.min.js"></script>
    
    <script type="text/javascript" src="mjpegcanvasjs/build/mjpegcanvas.min.js"></script>

    <script type="text/javascript">
      var hostname = location.hostname;

      /**
      * Setup all GUI elements when the page is loaded.
      */
      function init() {
      // Connecting to ROS.
      var ros = new ROSLIB.Ros({
      url : 'ws://'+hostname+'/linda/rosws'
      });

 
      // ----------------------------------------------------------------------
      // Subscribing to the robot's Battery
      // ----------------------------------------------------------------------

      // The ROSLIB.Topic handles subscribing and publishing a ROS topic. This
      // topic interacts with the /robot_pose topic, published by the robot.
      var batteryTopic = new ROSLIB.Topic({
      ros         : ros,
      name        : '/webthrottle/battery_state',
      messageType : 'scitos_msgs/BatteryState'
      });

      // Subscribes to the robot's battery state. 
      batteryTopic.subscribe(function(message) { 
	var estChargeTime=5*(85-message.lifePercent);
	var estDischargeTime=11*(message.lifePercent-30);
	var chargingText='';
	if (message.charging) {
		chargingText='Linda is currently <b>recharging</b> at a current of '+(-message.current.toFixed(1))+' Amperes. Her current charging level is <b>' + message.lifePercent + '%</b>';
	} else {
		chargingText='Linda is currently <b>running on battery</b> drawing a current of '+(message.current.toFixed(1))+' Amperes. Her current charging level is <b>' + message.lifePercent + '%</b>. ';
	}

      	$('#battery').html(chargingText);
      });


        // ----------------------------------------------------------------------
        // Create the camera viewer.
        // ----------------------------------------------------------------------


        var viewer = new MJPEGCANVAS.Viewer({
        divID : 'mjpeg',
        host : hostname,
        port : '80/linda/video',
        width : 560,
        height : 420,
        topic : '/image_blurrer/output_video'
        });

        
        // ----------------------------------------------------------------------
        // Rendering the robot in 3D
        // ----------------------------------------------------------------------

        // Create the scene manager and view port for the 3D world.
        var viewer3D = new ROS3D.Viewer({
        divID      : 'threed-map',
        width      : 560,
        height     : 320,
        antialias  : true,
	cameraPose : {x: 10, y: 10, z: 15},
        background : '#EEEEEE'
        });

        // Create a TF client that subscribes to the fixed frame.
        var tfClient = new ROSLIB.TFClient({
        ros          : ros,
        angularThres : 0.1,
        transThres   : 0.1,
        rate         : 1.0,
        fixedFrame   : '/map'
        });


        // Add the URDF model of the robot.
        var urdfClient = new ROS3D.UrdfClient({
        ros        : ros,
        tfClient   : tfClient,
        rootObject : viewer3D.scene
        });

        var colorMaterial = ROS3D.makeColorMaterial(1, 0, 0,0.5);

        // Track robot pose with an arrow
        var arrowNode = new ROS3D.SceneNode({
        tfClient : tfClient,
        frameID  : '/base_link',
        object   : new ROS3D.Arrow({
        length : 0.3,
        material : colorMaterial
        }),        
        });

        viewer3D.scene.add(arrowNode);


        // ----------------------------------------------------------------------
        // Rendering the map in 3D
        // ----------------------------------------------------------------------

        // Add the Occupancy Grid map.
        var grid = new ROS3D.OccupancyGridClient({
        ros        : ros,
        tfClient   : tfClient,
        rootObject : viewer3D.scene
        });
        grid.on('change', function() {
        // Change the opacity level.
        grid.currentGrid.children[0].material.transparent = false;
        grid.currentGrid.children[0].material.opacity = 0.85;
        grid.currentGrid.children[0].material.needsUpdate = true;
        });
        }
    </script>
  </head>

  <body onload="init()">
    <div class="navbar navbar-inverse navbar-fixed-top">
      <a class="navbar-brand" href="#"><img src="http://www.lincoln.ac.uk/home/media/universityoflincoln/styleassets/images/logo-white.png"/></a>      
      <ul class="nav pull-right">
        <li><a href="http://lcas.lincoln.ac.uk">L-CAS</a></li>
        <li><a href="http://strands-project.eu">STRANDS</a></li>
	<li class="active"><a href="linda.html">Linda Live</a></li>
      </ul>
    </div>
    <!--<div class="container">-->
<!--
      <div class="row">
	<H1><font color="red">BETA WEBSITE, subject to continuous modification and only available occasionally for now</font></H1>
      </div>
      <br/>
-->
      <div class="row">
      <H1>
        <i>Robots on Patrol</i> - Linda
      </H1>
      <br/>
      <div class="col-span-6">
        <p>
          Hello, my name is Linda. I am a research robot. I am usually based at
          the <a href="http://lcas.lincoln.ac.uk">Centre for Autonomous Systems</a> at
          the <a href="http://www.lincoln.ac.uk">University of Lincoln</a>,
          UK. Im here in London to show off at the Natural History Museum how I can patrol buildings (and to tweet pictures of you).
          </p>

        <div style="background: rgba(226,226,226,1);border-radius: 10px 10px 10px 10px;-moz-border-radius: 10px 10px 10px 10px;-webkit-border-radius: 10px 10px 10px 10px;border: 0px solid #000000;">
 		<H3>Linda's latest tweets at <b>@LindaStrands</b> <img src="https://g.twimg.com/Twitter_logo_blue.png" width="30px"/></H3>
 		<p>If you want to see yourself tweeted by Linda, find her and hold your "Robots on Patrol" lanyard card for her to see!</p>
			<div class="col-span-2">
		<a href="http://strands.acin.tuwien.ac.at/"><img src="http://strands.acin.tuwien.ac.at/logos/strands2.png"/></a>
	</div>
		<a class="twitter-timeline" href="https://twitter.com/LindaStrands" width="800" height="400" data-chrome="nofooter transparent noheader noscrollbar" data-widget-id="474206422993866754">Tweets by @LindaStrands</a>
		<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
        </div>
        <div class="col-span-6">
          <h1><small>Live 3D map</small></h1>
          <div id="threed-map"></div>
        </div>

      </div>
      <div class="col-span-6">
	<iframe width="800" height="538" src="//www.youtube.com/embed/videoseries?list=PLPY1_sJa70XA7bH05Y-WEJ0zXOGvpooYe&autoplay=1" frameborder="0" allowfullscreen></iframe>
      </div>
        <div class="col-span-6">
          <h1><small>Robot live cam</small></h1>
          <div id="mjpeg"></div>
        </div>
      </div>

	




  </body>
</html>
